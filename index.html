<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Антипремия "Так себе достижения"</title>
    <link rel="stylesheet" href="style.css">
    <!-- Дополнительные мета-теги для мобильных -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#5e35b1">
    
    <style>
        /* Дополнительные inline стили для мобильной совместимости */
        * {
            -webkit-tap-highlight-color: rgba(94, 53, 177, 0.3);
        }
        
        /* Быстрая анимация нажатия */
        .mobile-tap {
            transition: transform 0.1s ease, opacity 0.1s ease;
        }
        
        .mobile-tap:active {
            transform: scale(0.97);
            opacity: 0.9;
        }
        
        /* Исправление для iOS input zoom */
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }
        
        /* Улучшенные тач-цели для маленьких экранов */
        @media (max-width: 480px) {
            button, .student-card, .mobile-student-item {
                min-height: 48px !important;
                min-width: 48px !important;
            }
        }
    </style>
</head>
<body>
    <div id="snowflakes-container"></div>
    
    <div class="container">
        <div id="registrationSection" class="auth-container">
            <div class="logo-header">
                <div class="award-badge">
                    <div class="badge-icon"></div>
                    <div class="badge-text">Антипремия 2025</div>
                </div>
                <h1 class="main-title">"Так себе достижения"</h1>
                <p class="subtitle">Голосование за самые незаметные подвиги в учебном процессе</p>
            </div>
            
            <div class="form-group">
                <label for="userName">Ваше ФИО:</label>
                <input type="text" id="userName" placeholder="Иванов Иван Иванович">
                <div class="error-message" id="nameError">Введите полное ФИО (минимум 2 слова)</div>
            </div>
            
            <div class="form-group">
                <label for="userEmail">Ваш email:</label>
                <input type="email" id="userEmail" placeholder="ivanov@example.com">
                <div class="error-message" id="emailError">Введите корректный email</div>
            </div>
            
            <button class="login-button" onclick="registerUser()">
                <span class="button-text">Начать голосование</span>
                <span class="button-arrow"></span>
            </button>
            
            <div class="warning-note">
                Важно: Один человек — один голос. После регистрации выход из системы невозможен.
            </div>
        </div>

        <div id="votingSection" style="display: none;">
            <div class="header">
                <div class="title-section">
                    <div class="main-award-title">
                        <span class="award-text">Антипремия</span>
                        <span class="award-subtext">"Так себе достижения"</span>
                    </div>
                    <p class="gold-subtitle">Выберите лучших в каждой номинации</p>
                </div>

                <button class="admin-access-btn" onclick="showPasswordModal()">Админ</button>
            </div>

            <div class="nominations-container">
                <div class="garland-separator">
                    <div class="garland-string"></div>
                    <div class="garland-balls"></div>
                </div>
                
                <div class="main-nominations">
                    <h2 class="section-title">Главные номинации</h2>
                    <div class="nominations-grid main-grid" id="mainNominationsContainer"></div>
                </div>
                
                <div class="garland-separator">
                    <div class="garland-string"></div>
                    <div class="garland-balls"></div>
                </div>
                
                <div class="other-nominations">
                    <h2 class="section-title">Антиноминации</h2>
                    <div class="nominations-grid other-grid" id="otherNominationsContainer"></div>
                </div>
                
                <div class="garland-separator">
                    <div class="garland-string"></div>
                    <div class="garland-balls"></div>
                </div>
            </div>

            <div class="info-section">
                <div class="info-content">
                    <h3 class="info-title">Голосование проводится среди группы</h3>
                    <p class="info-text">
                        Все номинации являются шуточными и созданы в неформальной обстановке. 
                        Голосуя, вы принимаете участие в дружеском соревновании, где каждый 
                        студент может получить свою минуту славы за самые "так себе" достижения 
                        в учебном году.
                    </p>
                    <p class="info-text">
                        Голосование полностью анонимное. Никто не узнает, за кого конкретно 
                        вы голосовали. Будут показаны только общие результаты - за кого 
                        голосовали больше всего в каждой номинации.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="modal-title" id="modalTitle">Выберите студента</h2>
            <div class="students-grid" id="studentsGrid"></div>
            <button id="confirmSelection" class="confirm-button" onclick="confirmSelection()" disabled>
                <span class="button-text">Подтвердить выбор</span>
                <span class="button-arrow"></span>
            </button>
        </div>
    </div>

    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePasswordModal()">&times;</span>
            <h2 class="modal-title">Админ-доступ</h2>
            <div class="form-group">
                <label for="adminPassword">Пароль:</label>
                <input type="password" id="adminPassword" placeholder="Введите пароль">
            </div>
            <button class="confirm-button" onclick="checkAdminPassword()">
                <span class="button-text">Войти</span>
                <span class="button-arrow"></span>
            </button>
        </div>
    </div>

    <div id="adminPanel" class="modal">
        <div class="modal-content admin-modal">
            <span class="close" onclick="hideAdminPanel()">&times;</span>
            <h2 class="modal-title">Админ-панель</h2>
            <div class="admin-controls">
                <button class="admin-button" onclick="showLiveResults()">
                    <span class="button-text">Результаты</span>
                </button>
                <button class="admin-button" onclick="showAllVoters()">
                    <span class="button-text">Проголосовавшие</span>
                </button>
                <button class="admin-button" onclick="downloadResultsImage()">
                    <span class="button-text">Скачать как картинку</span>
                </button>
                <button class="admin-button" onclick="resetVoting()">
                    <span class="button-text">Сбросить голосование</span>
                </button>
            </div>
        </div>
    </div>

    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeResults()">&times;</span>
            <h2 class="modal-title" id="resultsTitle">Результаты</h2>
            <div class="results-grid" id="resultsGrid"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="script.js"></script>
    
    <!-- Скрипт для улучшения мобильной совместимости -->
    <script>
        // Функция для добавления класса при касании
        function addMobileTapClass() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                document.addEventListener('touchstart', function(e) {
                    const target = e.target;
                    if (target.tagName === 'BUTTON' || 
                        target.closest('button') || 
                        target.classList.contains('student-card') ||
                        target.closest('.student-card') ||
                        target.classList.contains('mobile-student-item') ||
                        target.closest('.mobile-student-item') ||
                        target.classList.contains('nomination-card') ||
                        target.closest('.nomination-card')) {
                        
                        const element = target.tagName === 'BUTTON' ? target : 
                                      target.closest('button') || 
                                      target.closest('.student-card') || 
                                      target.closest('.mobile-student-item') || 
                                      target.closest('.nomination-card');
                        
                        if (element) {
                            element.classList.add('mobile-tap');
                            
                            setTimeout(() => {
                                element.classList.remove('mobile-tap');
                            }, 150);
                        }
                    }
                }, { passive: true });
            }
        }
        
        // Исправление для iOS 100vh
        function fixIOSViewport() {
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
                
                window.addEventListener('resize', () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                });
            }
        }
        
        // Предотвращение масштабирования при фокусе на input
        function preventZoomOnFocus() {
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                document.addEventListener('focusin', function(e) {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                        setTimeout(() => {
                            e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 300);
                    }
                });
            }
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            addMobileTapClass();
            fixIOSViewport();
            preventZoomOnFocus();
            
            // Улучшенная обработка для всех кнопок на мобильных
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // Добавляем атрибуты для лучшей доступности
                document.querySelectorAll('button').forEach(button => {
                    button.setAttribute('role', 'button');
                    button.setAttribute('aria-label', button.textContent.trim());
                });
                
                // Улучшаем тач-события
                document.addEventListener('touchstart', function() {}, {passive: true});
                document.addEventListener('touchmove', function() {}, {passive: true});
            }
        });
        
        // Исправление высоты на мобильных устройствах
        function setVHProperty() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        window.addEventListener('resize', setVHProperty);
        window.addEventListener('orientationchange', setVHProperty);
        
        // Вызываем сразу
        setVHProperty();
    </script>
    
    <!-- Стили для мобильных улучшений -->
    <style>
        :root {
            --vh: 1vh;
        }
        
        /* Исправление для мобильной высоты */
        @media (max-width: 768px) {
            body {
                min-height: calc(var(--vh, 1vh) * 100);
            }
            
            .modal-content {
                max-height: calc(var(--vh, 1vh) * 90);
            }
            
            .mobile-student-list {
                max-height: calc(var(--vh, 1vh) * 85);
            }
        }
        
        /* Улучшенные стили для активных состояний */
        button:active,
        .student-card:active,
        .mobile-student-item:active,
        .nomination-card:active {
            transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                       opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                       box-shadow 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Быстрая анимация для всех кликабельных элементов */
        .clickable {
            cursor: pointer;
            -webkit-tap-highlight-color: rgba(94, 53, 177, 0.3);
            user-select: none;
        }
        
        /* Предотвращение выделения текста */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Улучшенные стили для disabled элементов */
        [disabled] {
            pointer-events: none;
            opacity: 0.6;
        }
    </style>
</body>
</html>